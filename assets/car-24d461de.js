import{W as E,Z as O,S as G,d as H,P as q,H as K,n as Q,J as I,_ as v,M as S,g as B,$ as j,a0 as U,C as Z}from"./three.module-2e0eea6d.js";import{O as J}from"./OrbitControls-5ebfa66f.js";import{f as $,h as N,g as X,y as Y,o as ee,c as te,_ as oe}from"./index-4c8cf54e.js";const ne={id:"obb"},ae=$({__name:"car",setup(ie){let k=N(null),u,s,y={leftFront:null,rightFront:null,leftBack:null,rightBack:null},V=[],x,A={acceleration:!1,braking:!1,left:!1,right:!1},M={KeyW:"acceleration",KeyS:"braking",KeyA:"left",KeyD:"right"};const D=e=>{let n=new I(100,.2,100),i=new v({color:4473924,side:2}),r=new S(n,i);r.position.y-=2,e.add(r);let t=new Ammo.btBoxShape(new Ammo.btVector3(50,.1,50)),o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(new Ammo.btVector3(0,-2,0)),o.setRotation(new Ammo.btQuaternion(0,0,0,1));let a=new Ammo.btDefaultMotionState(o),c=new Ammo.btVector3(0,0,0);t.calculateLocalInertia(0,c);let l=new Ammo.btRigidBodyConstructionInfo(0,a,t,c);var m=new Ammo.btRigidBody(l);m.setFriction(2),u.addRigidBody(m);for(let d=0;d<8;d++)for(let g=0;g<4;g++)W(e,new B(d*1.5-3,g*.8-1.4,20))},W=(e,n)=>{let i=new I(1.5,.8,1);const r=new v({color:Math.floor(Math.random()*(1<<24))}),t=new S(i,r);t.position.copy(n),e.add(t);let o=new Ammo.btBoxShape(new Ammo.btVector3(.75,.4,.5)),a=new Ammo.btTransform;a.setIdentity(),a.setOrigin(new Ammo.btVector3(n.x,n.y,n.z)),a.setRotation(new Ammo.btQuaternion(0,0,0,1));let c=new Ammo.btDefaultMotionState(a),l=new Ammo.btVector3(0,0,0);o.calculateLocalInertia(0,l);let m=new Ammo.btRigidBodyConstructionInfo(10,c,o,l);var d=new Ammo.btRigidBody(m);d.setFriction(2),u.addRigidBody(d),d.setActivationState(4);function g(){var h=d.getMotionState();if(h){let C=new Ammo.btTransform;h.getWorldTransform(C);var w=C.getOrigin(),p=C.getRotation();t.position.set(w.x(),w.y(),w.z()),t.quaternion.set(p.x(),p.y(),p.z(),p.w())}}V.push(g)},z=e=>{let n=new I(10,4,2),i=new v({color:16729156}),r=new S(n,i);var t=new U(0,0,0,1);t.setFromAxisAngle(new B(1,0,0),-Math.PI/3),r.rotation.x=-Math.PI/3-Math.PI/20,r.position.y=-2,r.quaternion.copy(t),e.add(r);let o=new Ammo.btBoxShape(new Ammo.btVector3(5,2,1)),a=new Ammo.btTransform;a.setIdentity(),a.setOrigin(new Ammo.btVector3(0,-2,0)),a.setRotation(new Ammo.btQuaternion(t.x,t.y,t.z,t.w));let c=new Ammo.btDefaultMotionState(a),l=new Ammo.btVector3(0,0,0);o.calculateLocalInertia(0,l);let m=new Ammo.btRigidBodyConstructionInfo(0,c,o,l);var d=new Ammo.btRigidBody(m);d.setFriction(2),u.addRigidBody(d)},F=e=>{var n=new Ammo.btBoxShape(new Ammo.btVector3(1,.5,2)),i=new Ammo.btTransform;i.setIdentity(),i.setOrigin(new Ammo.btVector3(0,5,5)),i.setRotation(new Ammo.btQuaternion(0,0,0,1));var r=new Ammo.btDefaultMotionState(i),t=new Ammo.btVector3(0,0,0);n.calculateLocalInertia(800,t);var o=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(800,r,n,t));o.setActivationState(4),u.addRigidBody(o);var a=new Ammo.btVehicleTuning,a=new Ammo.btVehicleTuning,c=new Ammo.btDefaultVehicleRaycaster(u);s=new Ammo.btRaycastVehicle(a,o,c),s.setCoordinateSystem(0,1,2),u.addAction(s);let l=new I(2,1,4),m=new v({color:4521796}),d=new S(l,m);x=d,d.position.z=5,d.position.y=5,e.add(d);{let g=R(new B(-1,0,-2),0,a);e.add(g),y.leftFront=g;let h=R(new B(1,0,-2),1,a);e.add(h),y.leftBack=h;let w=R(new B(-1,0,2),2,a);e.add(w),y.rightFront=w;let p=R(new B(1,0,2),3,a);e.add(p),y.rightBack=p}},R=(e,n,i)=>{let r=new j(.5,.5,.2);r.rotateZ(Math.PI/2);let t=new v({color:4521972}),o=new S(r,t);o.position.set(e.x,e.y,e.z);let a=new I(.1,1,.1),c=new v({color:16777028}),l=n==0||n==2?.1:-.1,m=new S(a,c);m.position.x+=l,o.add(m);var d=new Ammo.btVector3(0,-1,0),g=new Ammo.btVector3(-1,0,0);let h=new Ammo.btVector3(e.x,e.y,e.z);var w=s.addWheel(h,d,g,.6,.5,i,!(n>=2));return w.set_m_suspensionStiffness(20),w.set_m_wheelsDampingRelaxation(2.3),w.set_m_wheelsDampingCompression(4.4),w.set_m_frictionSlip(1e3),w.set_m_rollInfluence(.2),o},L=async()=>{let e=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,n=new Ammo.btCollisionDispatcher(e),i=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver,t=new Ammo.btDefaultSoftBodySolver;u=new Ammo.btSoftRigidDynamicsWorld(n,i,r,e,t),u.setGravity(new Ammo.btVector3(0,-9.8,0))};let b=0,_=0,f=0;const P=e=>{let n=s==null?void 0:s.getCurrentSpeedKmHour();if(b=0,_=0,A.acceleration&&(n>1?b=100:_=-1e3),A.braking&&(n<-1?b=100:_=300),A.left?f<.5&&(f+=.03):A.right?f>-.5&&(f-=.03):f>.03?f-=.03:f<-.03?f+=.03:f=0,s&&(s.applyEngineForce(_,2),s.applyEngineForce(_,3),s.setBrake(b/2,0),s.setBrake(b/2,1),s.setBrake(b,2),s.setBrake(b,3),s.setSteeringValue(f,0),s.setSteeringValue(f,1)),u.stepSimulation(e,10),s){let i=["leftFront","leftBack","rightFront","rightBack"];for(let a=0;a<4;a++){s.updateWheelTransform(a,!0);let c=s.getWheelTransformWS(a),l=c.getOrigin(),m=c.getRotation();y[i[a]].position.set(l.x(),l.y(),l.z()),y[i[a]].quaternion.set(m.x(),m.y(),m.z(),m.w())}let r=s.getChassisWorldTransform(),t=r.getOrigin(),o=r.getRotation();x.position.set(t.x(),t.y(),t.z()),x.quaternion.set(o.x(),o.y(),o.z(),o.w())}for(let i of V)i()},T=()=>{window.addEventListener("keydown",e=>{if(M[e.code])return A[M[e.code]]=!0,e.preventDefault(),e.stopPropagation(),!1}),window.addEventListener("keyup",e=>{if(M[e.code])return A[M[e.code]]=!1,e.preventDefault(),e.stopPropagation(),!1})};return X(async()=>{const e=document.getElementById("obb"),n=new E({antialias:!0});n.setPixelRatio(window.devicePixelRatio),n.setSize(e.offsetWidth,e.offsetHeight),n.toneMapping=O,n.toneMappingExposure=1.5,e.appendChild(n.domElement);const i=new G;i.background=new H(12575709);const r=new q(40,e.offsetWidth/e.offsetHeight,1,1e3);r.position.set(50,10,10),r.lookAt(0,0,0);const t=new K;t.groundColor.lerp(t.color,.5),t.intensity=.5,t.position.set(0,1,0),t.visible=!0,i.add(t);const o=new Q(16777215);o.position.set(4,10,1),o.shadow.mapSize.width=2048,o.shadow.mapSize.height=2048,o.shadow.normalBias=.001,o.visible=!0,i.add(o),i.add(o.target);const a=new Z;L(),T(),F(i),D(i),z(i),new J(r,n.domElement).update(),window.onresize=function(){r.aspect=e.offsetWidth/e.offsetHeight,r.updateProjectionMatrix(),n.setSize(e.offsetWidth,e.offsetHeight)};function l(){const m=a.getDelta();k.value=requestAnimationFrame(l),P(m),n.render(i,r)}l()}),Y(()=>{cancelAnimationFrame(k.value)}),(e,n)=>(ee(),te("div",ne))}});const me=oe(ae,[["__scopeId","data-v-b49c48a3"]]);export{me as default};
