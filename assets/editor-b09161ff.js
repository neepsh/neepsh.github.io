import{f as Yt,h as N,g as Zt,y as Ht,o as zt,c as Tt,a as $,C as pt,F as jt,_ as Dt}from"./index-4c8cf54e.js";import{i as Et,g as l,an as ft,a0 as G,f as It,j as ht,af as Xt,$ as H,J as X,B as mt,F as yt,M as n,aP as st,ah as R,aQ as At,aR as J,a as Lt,D as kt,aS as qt,V as Ct,W as Gt,s as Rt,k as Ot,S as Wt,d as Ft,P as Bt,aO as Ut,au as bt}from"./three.module-2e0eea6d.js";import{O as Vt}from"./OrbitControls-5ebfa66f.js";import{R as Nt}from"./RoomEnvironment-c79c43e7.js";const B=new Et,z=new l,W=new l,g=new G,gt={X:new l(1,0,0),Y:new l(0,1,0),Z:new l(0,0,1)},dt={type:"change"},_t={type:"mouseDown"},vt={type:"mouseUp",mode:null},Pt={type:"objectChange"};class $t extends ft{constructor(o,r){super(),r===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),r=document),this.isTransformControls=!0,this.visible=!1,this.domElement=r,this.domElement.style.touchAction="none";const i=new ie;this._gizmo=i,this.add(i);const e=new oe;this._plane=e,this.add(e);const h=this;function t(S,D){let q=D;Object.defineProperty(h,S,{get:function(){return q!==void 0?q:D},set:function(a){q!==a&&(q=a,e[S]=a,i[S]=a,h.dispatchEvent({type:S+"-changed",value:a}),h.dispatchEvent(dt))}}),h[S]=D,e[S]=D,i[S]=D}t("camera",o),t("object",void 0),t("enabled",!0),t("axis",null),t("mode","translate"),t("translationSnap",null),t("rotationSnap",null),t("scaleSnap",null),t("space","world"),t("size",1),t("dragging",!1),t("showX",!0),t("showY",!0),t("showZ",!0);const s=new l,A=new l,L=new G,Y=new G,T=new l,Z=new G,F=new l,V=new l,j=new l,k=0,Q=new l;t("worldPosition",s),t("worldPositionStart",A),t("worldQuaternion",L),t("worldQuaternionStart",Y),t("cameraPosition",T),t("cameraQuaternion",Z),t("pointStart",F),t("pointEnd",V),t("rotationAxis",j),t("rotationAngle",k),t("eye",Q),this._offset=new l,this._startNorm=new l,this._endNorm=new l,this._cameraScale=new l,this._parentPosition=new l,this._parentQuaternion=new G,this._parentQuaternionInv=new G,this._parentScale=new l,this._worldScaleStart=new l,this._worldQuaternionInv=new G,this._worldScale=new l,this._positionStart=new l,this._quaternionStart=new G,this._scaleStart=new l,this._getPointer=Jt.bind(this),this._onPointerDown=te.bind(this),this._onPointerHover=Kt.bind(this),this._onPointerMove=ee.bind(this),this._onPointerUp=ne.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0)return;B.setFromCamera(o,this.camera);const r=ut(this._gizmo.picker[this.mode],B);r?this.axis=r.object.name:this.axis=null}pointerDown(o){if(!(this.object===void 0||this.dragging===!0||o.button!==0)&&this.axis!==null){B.setFromCamera(o,this.camera);const r=ut(this._plane,B,!0);r&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(r.point).sub(this.worldPositionStart)),this.dragging=!0,_t.mode=this.mode,this.dispatchEvent(_t)}}pointerMove(o){const r=this.axis,i=this.mode,e=this.object;let h=this.space;if(i==="scale"?h="local":(r==="E"||r==="XYZE"||r==="XYZ")&&(h="world"),e===void 0||r===null||this.dragging===!1||o.button!==-1)return;B.setFromCamera(o,this.camera);const t=ut(this._plane,B,!0);if(t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&r!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),r.indexOf("X")===-1&&(this._offset.x=0),r.indexOf("Y")===-1&&(this._offset.y=0),r.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&r!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),e.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(e.position.applyQuaternion(g.copy(this._quaternionStart).invert()),r.search("X")!==-1&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),r.search("Y")!==-1&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),r.search("Z")!==-1&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.position.applyQuaternion(this._quaternionStart)),h==="world"&&(e.parent&&e.position.add(z.setFromMatrixPosition(e.parent.matrixWorld)),r.search("X")!==-1&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),r.search("Y")!==-1&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),r.search("Z")!==-1&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.parent&&e.position.sub(z.setFromMatrixPosition(e.parent.matrixWorld))));else if(i==="scale"){if(r.search("XYZ")!==-1){let s=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(s*=-1),W.set(s,s,s)}else z.copy(this.pointStart),W.copy(this.pointEnd),z.applyQuaternion(this._worldQuaternionInv),W.applyQuaternion(this._worldQuaternionInv),W.divide(z),r.search("X")===-1&&(W.x=1),r.search("Y")===-1&&(W.y=1),r.search("Z")===-1&&(W.z=1);e.scale.copy(this._scaleStart).multiply(W),this.scaleSnap&&(r.search("X")!==-1&&(e.scale.x=Math.round(e.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),r.search("Y")!==-1&&(e.scale.y=Math.round(e.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),r.search("Z")!==-1&&(e.scale.z=Math.round(e.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const s=20/this.worldPosition.distanceTo(z.setFromMatrixPosition(this.camera.matrixWorld));r==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):r==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(z.copy(this.rotationAxis).cross(this.eye))*s):(r==="X"||r==="Y"||r==="Z")&&(this.rotationAxis.copy(gt[r]),z.copy(gt[r]),h==="local"&&z.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(z.cross(this.eye).normalize())*s),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&r!=="E"&&r!=="XYZE"?(e.quaternion.copy(this._quaternionStart),e.quaternion.multiply(g.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),e.quaternion.copy(g.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),e.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(dt),this.dispatchEvent(Pt)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(vt.mode=this.mode,this.dispatchEvent(vt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(dt),this.dispatchEvent(Pt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return B}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}}function Jt(v){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:v.button};{const o=this.domElement.getBoundingClientRect();return{x:(v.clientX-o.left)/o.width*2-1,y:-(v.clientY-o.top)/o.height*2+1,button:v.button}}}function Kt(v){if(this.enabled)switch(v.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(v));break}}function te(v){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(v.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(v)),this.pointerDown(this._getPointer(v)))}function ee(v){this.enabled&&this.pointerMove(this._getPointer(v))}function ne(v){this.enabled&&(this.domElement.releasePointerCapture(v.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(v)))}function ut(v,o,r){const i=o.intersectObject(v,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||r)return i[e];return!1}const at=new qt,f=new l(0,1,0),xt=new l(0,0,0),St=new It,rt=new G,ct=new G,C=new l,Mt=new It,et=new l(1,0,0),U=new l(0,1,0),nt=new l(0,0,1),lt=new l,K=new l,tt=new l;class ie extends ft{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new ht({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=new Xt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=o.clone();i.opacity=.15;const e=r.clone();e.opacity=.5;const h=o.clone();h.color.setHex(16711680);const t=o.clone();t.color.setHex(65280);const s=o.clone();s.color.setHex(255);const A=o.clone();A.color.setHex(16711680),A.opacity=.5;const L=o.clone();L.color.setHex(65280),L.opacity=.5;const Y=o.clone();Y.color.setHex(255),Y.opacity=.5;const T=o.clone();T.opacity=.25;const Z=o.clone();Z.color.setHex(16776960),Z.opacity=.25,o.clone().color.setHex(16776960);const V=o.clone();V.color.setHex(7895160);const j=new H(0,.04,.1,12);j.translate(0,.05,0);const k=new X(.08,.08,.08);k.translate(0,.04,0);const Q=new mt;Q.setAttribute("position",new yt([0,0,0,1,0,0],3));const S=new H(.0075,.0075,.5,3);S.translate(0,.25,0);function D(w,I){const y=new J(w,.0075,3,64,I*Math.PI*2);return y.rotateY(Math.PI/2),y.rotateX(Math.PI/2),y}function q(){const w=new mt;return w.setAttribute("position",new yt([0,0,0,1,1,1],3)),w}const a={X:[[new n(j,h),[.5,0,0],[0,0,-Math.PI/2]],[new n(j,h),[-.5,0,0],[0,0,Math.PI/2]],[new n(S,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n(j,t),[0,.5,0]],[new n(j,t),[0,-.5,0],[Math.PI,0,0]],[new n(S,t)]],Z:[[new n(j,s),[0,0,.5],[Math.PI/2,0,0]],[new n(j,s),[0,0,-.5],[-Math.PI/2,0,0]],[new n(S,s),null,[Math.PI/2,0,0]]],XYZ:[[new n(new st(.1,0),T.clone()),[0,0,0]]],XY:[[new n(new X(.15,.15,.01),Y.clone()),[.15,.15,0]]],YZ:[[new n(new X(.15,.15,.01),A.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new X(.15,.15,.01),L.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},c={X:[[new n(new H(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n(new H(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new H(.2,0,.6,4),i),[0,.3,0]],[new n(new H(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new H(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n(new H(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n(new st(.2,0),i)]],XY:[[new n(new X(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n(new X(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new X(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},p={START:[[new n(new st(.01,2),e),null,null,null,"helper"]],END:[[new n(new st(.01,2),e),null,null,null,"helper"]],DELTA:[[new R(q(),e),null,null,null,"helper"]],X:[[new R(Q,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new R(Q,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new R(Q,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},d={XYZE:[[new n(D(.5,1),V),null,[0,Math.PI/2,0]]],X:[[new n(D(.5,.5),h)]],Y:[[new n(D(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new n(D(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new n(D(.75,1),Z),null,[0,Math.PI/2,0]]]},m={AXIS:[[new R(Q,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},_={XYZE:[[new n(new At(.25,10,8),i)]],X:[[new n(new J(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n(new J(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n(new J(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n(new J(.75,.1,2,24),i)]]},M={X:[[new n(k,h),[.5,0,0],[0,0,-Math.PI/2]],[new n(S,h),[0,0,0],[0,0,-Math.PI/2]],[new n(k,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n(k,t),[0,.5,0]],[new n(S,t)],[new n(k,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n(k,s),[0,0,.5],[Math.PI/2,0,0]],[new n(S,s),[0,0,0],[Math.PI/2,0,0]],[new n(k,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n(new X(.15,.15,.01),Y),[.15,.15,0]]],YZ:[[new n(new X(.15,.15,.01),A),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new X(.15,.15,.01),L),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new X(.1,.1,.1),T.clone())]]},E={X:[[new n(new H(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n(new H(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new H(.2,0,.6,4),i),[0,.3,0]],[new n(new H(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new H(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n(new H(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n(new X(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n(new X(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new X(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new X(.2,.2,.2),i),[0,0,0]]]},x={X:[[new R(Q,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new R(Q,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new R(Q,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function P(w){const I=new ft;for(const y in w)for(let b=w[y].length;b--;){const u=w[y][b][0].clone(),O=w[y][b][1],it=w[y][b][2],ot=w[y][b][3],Qt=w[y][b][4];u.name=y,u.tag=Qt,O&&u.position.set(O[0],O[1],O[2]),it&&u.rotation.set(it[0],it[1],it[2]),ot&&u.scale.set(ot[0],ot[1],ot[2]),u.updateMatrix();const wt=u.geometry.clone();wt.applyMatrix4(u.matrix),u.geometry=wt,u.renderOrder=1/0,u.position.set(0,0,0),u.rotation.set(0,0,0),u.scale.set(1,1,1),I.add(u)}return I}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(a)),this.add(this.gizmo.rotate=P(d)),this.add(this.gizmo.scale=P(M)),this.add(this.picker.translate=P(c)),this.add(this.picker.rotate=P(_)),this.add(this.picker.scale=P(E)),this.add(this.helper.translate=P(p)),this.add(this.helper.rotate=P(m)),this.add(this.helper.scale=P(x)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ct;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let e=[];e=e.concat(this.picker[this.mode].children),e=e.concat(this.gizmo[this.mode].children),e=e.concat(this.helper[this.mode].children);for(let h=0;h<e.length;h++){const t=e[h];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let s;if(this.camera.isOrthographicCamera?s=(this.camera.top-this.camera.bottom)/this.camera.zoom:s=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(s*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.visible=!!this.axis,this.axis==="X"&&(g.setFromEuler(at.set(0,0,0)),t.quaternion.copy(i).multiply(g),Math.abs(f.copy(et).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(g.setFromEuler(at.set(0,0,Math.PI/2)),t.quaternion.copy(i).multiply(g),Math.abs(f.copy(U).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(g.setFromEuler(at.set(0,Math.PI/2,0)),t.quaternion.copy(i).multiply(g),Math.abs(f.copy(nt).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(g.setFromEuler(at.set(0,Math.PI/2,0)),f.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(St.lookAt(xt,f,U)),t.quaternion.multiply(g),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),z.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),z.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(z),t.visible=this.dragging):(t.quaternion.copy(i),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(f.copy(et).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(f.copy(U).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(f.copy(nt).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(f.copy(nt).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(f.copy(et).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(f.copy(U).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&(rt.copy(i),f.copy(this.eye).applyQuaternion(g.copy(i).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(St.lookAt(this.eye,xt,U)),t.name==="X"&&(g.setFromAxisAngle(et,Math.atan2(-f.y,f.z)),g.multiplyQuaternions(rt,g),t.quaternion.copy(g)),t.name==="Y"&&(g.setFromAxisAngle(U,Math.atan2(f.x,f.z)),g.multiplyQuaternions(rt,g),t.quaternion.copy(g)),t.name==="Z"&&(g.setFromAxisAngle(nt,Math.atan2(f.y,f.x)),g.multiplyQuaternions(rt,g),t.quaternion.copy(g))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(A){return t.name===A}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(o)}}class oe extends n{constructor(){super(new Lt(1e5,1e5,2,2),new ht({visible:!1,wireframe:!0,side:kt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let r=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(r="local"),lt.copy(et).applyQuaternion(r==="local"?this.worldQuaternion:ct),K.copy(U).applyQuaternion(r==="local"?this.worldQuaternion:ct),tt.copy(nt).applyQuaternion(r==="local"?this.worldQuaternion:ct),f.copy(K),this.mode){case"translate":case"scale":switch(this.axis){case"X":f.copy(this.eye).cross(lt),C.copy(lt).cross(f);break;case"Y":f.copy(this.eye).cross(K),C.copy(K).cross(f);break;case"Z":f.copy(this.eye).cross(tt),C.copy(tt).cross(f);break;case"XY":C.copy(tt);break;case"YZ":C.copy(lt);break;case"XZ":f.copy(tt),C.copy(K);break;case"XYZ":case"E":C.set(0,0,0);break}break;case"rotate":default:C.set(0,0,0)}C.length()===0?this.quaternion.copy(this.cameraQuaternion):(Mt.lookAt(z.set(0,0,0),C,f),this.quaternion.setFromRotationMatrix(Mt)),super.updateMatrixWorld(o)}}const se={class:"btn"},ae=Yt({__name:"editor",setup(v){let o=N(!1),r=N(null),i=N(!1),e=null,h=N(3),t=new l,s=[new l,new l,new l,new l],A=0,L=new Ct,Y=null,T=null;N(1);let Z=[[],[],[],[]],F=null;const V=a=>{console.log(43444,o.value),!o.value&&(L.x=a.offsetX/a.target.offsetWidth*2-1,L.y=-(a.offsetY/a.target.offsetHeight)*2+1,i.value=!0)},j=a=>{h.value=a},k=a=>{let c=a.object.geometry;F=a.object.geometry,console.log(a),A=a.faceIndex*3;let p=0;h.value===1&&c.clearGroups();for(let d=0;d<6;d++){if(A>=p&&A<p+6){let m=new l;if(s[0].fromBufferAttribute(c.attributes.position,c.index.array[p]),s[1].fromBufferAttribute(c.attributes.position,c.index.array[p+1]),s[2].fromBufferAttribute(c.attributes.position,c.index.array[p+4]),s[3].fromBufferAttribute(c.attributes.position,c.index.array[p+5]),h.value===1)m.add(s[0]).add(s[1]).add(s[2]).add(s[3]).multiplyScalar(.25),q(s,c.attributes.position),c.addGroup(p,6,1);else if(h.value===2){let _=Q(s[0],s[1],a.point),M=Q(s[1],s[2],a.point),E=Q(s[2],s[3],a.point),x=Q(s[3],s[0],a.point),P=Math.min(_,M,E,x),w=[],I=[new l,new l,new l,new l],y=[_,M,E,x];for(let b=0;b<y.length;b++)if(y[b]===P){b===3?(I[b]=s[b],I[0]=s[b],w.push(s[b],s[0])):(I[b]=s[b],I[b+1]=s[b+1],w.push(s[b],s[b+1]));break}m.add(w[0]).add(w[1]).multiplyScalar(.5),q(I,c.attributes.position),Y.geometry.setFromPoints(w),Y.geometry.needsUpdate=!0,Y.enabled=!0,Y.visiable=!0}else{let _=new l().copy(s[0]).sub(a.point).length(),M=new l().copy(s[1]).sub(a.point).length(),E=new l().copy(s[2]).sub(a.point).length(),x=new l().copy(s[0]).sub(a.point).length(),P=Math.min(_,M,E,x),w=new Array;w.length=4;let I=[_,M,E,x];for(let y=0;y<I.length;y++)I[y]===P&&(m=s[y],w[y]=s[y]);q(w,c.attributes.position),T.position.set(m.x,m.y,m.z),T.enabled=!0,T.visiable=!0}t.copy(m),e.object.position.set(m.x,m.y,m.z),e.enabled=!0,e.visible=!0}else h.value===1&&c.addGroup(p,6,0);console.log(Z),p+=6}},Q=(a,c,p)=>{let d=new l().copy(a).sub(c),_=new l().copy(p).sub(c).dot(d)/d.lengthSq(),M=new l().copy(a).addScaledVector(d,_/d.length());return new l().copy(p).sub(M).length()},S=a=>{if(h.value===1){e.enabled=!1,e.visible=!1,console.log(12312312),a.clearGroups();for(let c=0;c<6;c++)a.addGroup(c*6,6,0)}},D=()=>{let a=e.object.position.clone().sub(t),c=new l().addVectors(s[0],a),p=new l().addVectors(s[1],a),d=new l().addVectors(s[2],a),m=new l().addVectors(s[3],a),_=F.attributes.position,M=0;for(let E=0;E<6;E++){if(A>=M&&A<M+6)for(let x=0;x<Z.length;x++)for(let P of Z[x])x===0&&_.setXYZ(P,c.x,c.y,c.z),x===1&&_.setXYZ(P,p.x,p.y,p.z),x===2&&_.setXYZ(P,d.x,d.y,d.z),x===3&&_.setXYZ(P,m.x,m.y,m.z);M+=6}_.needsUpdate=!0,console.log(_)},q=(a,c)=>{Z=[[],[],[],[]];for(let p=0;p<c.count;p++){let d=new l().fromBufferAttribute(c,p);a[0]&&d.equals(a[0])&&Z[0].push(p),a[1]&&d.equals(a[1])&&Z[1].push(p),a[2]&&d.equals(a[2])&&Z[2].push(p),a[3]&&d.equals(a[3])&&Z[3].push(p)}};return Zt(()=>{const a=document.getElementById("robot"),c=new Gt({antialias:!0});c.setPixelRatio(window.devicePixelRatio),c.setSize(a.offsetWidth,a.offsetHeight),c.outputEncoding=Rt,a.appendChild(c.domElement);const p=new Ot(c),d=new Wt;d.background=new Ft(12575709),d.environment=p.fromScene(new Nt,.04).texture;const m=new Bt(40,a.offsetWidth/a.offsetHeight,1,100);m.position.set(5,2,8);const _=new Vt(m,c.domElement);_.target.set(0,.5,0),_.update(),_.enablePan=!1,_.enableDamping=!0,e=new $t(m,c.domElement),e.addEventListener("objectChange",u=>{D()}),e.addEventListener("dragging-changed",function(u){_.enabled=!u.value,o.value=!o.value});let M=new n(new X(1,1,1),new ht({color:16711680}));M.visible=!1,d.add(M),e.attach(M),e.object.position.set(.5,0,0),e.visible=!1,e.enabled=!1;{let u=new mt,O=new Xt({color:255});Y=new R(u,O),Y.visible=!1,Y.enabled=!1,d.add(F)}{let u=new At(15,32,16),O=new ht({color:255});T=new n(u,O),T.scale.set(.1,.1,.1),T.visible=!1,T.enabled=!1,d.add(F)}d.add(e);let E=new Ut(1,1,1);E.clearGroups();let x=0;for(let u=0;u<6;u++)E.addGroup(x,6,0),x+=6;let P=new bt({color:16711935,roughness:.5,metalness:.5}),w=new bt({color:16776960,roughness:.5,metalness:.5}),I=new n(E,[P,w]);d.add(I);let y=new Et;b(),window.onresize=function(){m.aspect=a.offsetWidth/a.offsetHeight,m.updateProjectionMatrix(),c.setSize(a.offsetWidth,a.offsetHeight)};function b(){if(r.value=requestAnimationFrame(b),i.value){y.setFromCamera(L,m);const u=y.intersectObjects([I],!1);i.value=!1,u.length?k(u[0]):S(E)}_.update(),c.render(d,m)}}),Ht(()=>{cancelAnimationFrame(r.value)}),(a,c)=>(zt(),Tt(jt,null,[$("div",se,[$("div",{onClick:c[0]||(c[0]=pt(p=>j(1),["stop"]))},"面"),$("div",{onClick:c[1]||(c[1]=pt(p=>j(2),["stop"]))},"线段"),$("div",{onClick:c[2]||(c[2]=pt(p=>j(3),["stop"]))},"顶点")]),$("div",{onMousedown:V,id:"robot"},null,32)],64))}});const pe=Dt(ae,[["__scopeId","data-v-41e6f379"]]);export{pe as default};
